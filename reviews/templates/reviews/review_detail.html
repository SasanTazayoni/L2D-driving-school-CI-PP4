{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block head_title %}{% trans "L2D - Review Detail" %}{% endblock head_title %}

{% block content %}
<section class="block--grey">
    <header class="page-header">
        <h1>Review Details</h1>
    </header>
    <div class="container mt-5 mb-2">
        <div class="card card--gradient">
            <header>
                {% if review.author.profile_picture %}
                    <img src="{{ review.author.profile_picture.url }}" alt="{{ review.author.user.username }}" class="review-image">
                {% else %}
                    <img src="{% static 'images/defaultpicture.png' %}" alt="{{ profile.user.username }}" class="review-image" />
                {% endif %}
                <h2>Review by {{ review.author }} on {{ review.created_on }}</h2>
            </header>
            <h1 class="post-title">{{ review.rating }}</h1>
            <!-- Displaying count of comments and likes -->
            <div class="row">
                <div class="col-12">
                    <strong class="text-secondary">
                        <i class="far fa-comments"></i> {{ comment_count }}
                    </strong>
                </div>
                <div class="col-12">
                    <form action="{% url 'like_review' review_id %}" method="POST">
                        {% csrf_token %}
                        <strong class="text-secondary">
                            {% if request.user.is_authenticated %}
                                {% if not is_edit_comment_view %}
                                    <button type="submit" name="like_id" value="{{ review.id }}">
                                    {% if liked %}
                                        <i class="fa-solid fa-heart"></i>
                                    {% else %}
                                        <i class="fa-regular fa-heart"></i>
                                    {% endif %}
                                        </button>
                                    {% endif %}
                                {% endif %}
                            {% if not request.user.is_authenticated or is_edit_comment_view %}
                                {% if like_count > 0 %}
                                    <i class="fa-solid fa-heart"></i>
                                {% else %}
                                    <i class="fa-regular fa-heart"></i>
                                {% endif %}
                            {% endif %} {{ like_count }}
                        </strong>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col card mb-4  mt-3 left  top">
                <div class="card-body">
                    <!-- The post content goes inside the card-text. -->
                    <!-- Use the | safe filter inside the template tags -->
                    <p class="card-text">
                        {{ review.content | safe }}
                    </p>
                </div>
            </div>
        </div>
        <!-- Displaying Comments -->
        <div class="row">
            <div class="col-md-8 card mb-4  mt-3 ">
                <h3>Comments:</h3>
                <div class="card-body">
                    <!-- We want a for loop inside the empty control tags
            to iterate through each comment in comments -->
                    {% for comment in comments %}
                    <div class="p-2 comments
            {% if not comment.approved and comment.author == user %}
            faded{% elif not comment.approved %} d-none{% endif %}">
                        <p class="font-weight-bold">
                            {{ comment.author }}
                            <span class="font-weight-normal">
                                {{ comment.replied_on }}
                            </span> wrote:
                        </p>
                        <div id="comment{{ comment.id }}">
                            {{ comment.content | linebreaks }}
                        </div>
                        {% if not comment.approved and comment.author == user %}
                        <p class="approval">
                            This comment is awaiting approval
                        </p>
                        {% endif %}
                    </div>
                    <!-- Our for loop ends here -->
                    {% endfor %}
                </div>
            </div>
            <!-- Creating New Comments -->
            <div class="col-md-4 card mb-4 mt-3">
                <div class="card-body">
                    {% if user.is_authenticated %}
                    <h3>Leave a comment:</h3>
                    <p>Posting as: {{ user.username }}</p>
                    <form id="commentForm" method="post" style="margin-top: 1.3em;">
                        {{ comment_form }}
                        {% csrf_token %}
                        <button id="submitButton" type="submit" class="btn btn-signup btn-lg">Submit</button>
                    </form>
                    {% else %}
                    <p>Log in to leave a comment</p>
                    {% endif %}
                </div>
            </div>
        </div>
</section>

{% endblock content %}